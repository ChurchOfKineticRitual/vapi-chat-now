<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nutrition - Vapi Voice Assistant</title>
    <meta name="description" content="Nutrition Voice Assistant powered by Vapi" />
    
    <style>
        /* Reset and base styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: linear-gradient(135deg, hsl(210, 100%, 6%) 0%, hsl(280, 100%, 8%) 100%);
            color: hsl(210, 40%, 98%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Cyberpunk grid background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(hsl(180, 100%, 50%, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, hsl(180, 100%, 50%, 0.02) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: 0;
        }

        /* Container */
        .container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            position: relative;
            z-index: 1;
        }

        /* Card */
        .card {
            width: 100%;
            max-width: 28rem;
            background: hsl(210, 40%, 8%, 0.8);
            backdrop-filter: blur(8px);
            border: 1px solid hsl(210, 40%, 20%, 0.5);
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            box-shadow: 
                0 10px 25px -3px hsl(180, 100%, 50%, 0.1),
                0 4px 6px -2px hsl(180, 100%, 50%, 0.05);
        }

        /* Header */
        .header {
            margin-bottom: 1.5rem;
        }

        .title {
            font-size: 1.875rem;
            font-weight: 700;
            color: hsl(180, 100%, 50%);
            margin-bottom: 0.5rem;
        }

        /* Button */
        .button {
            width: 100%;
            height: 4rem;
            font-size: 1.125rem;
            font-weight: 600;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .button:enabled {
            background: linear-gradient(135deg, hsl(180, 100%, 50%) 0%, hsl(280, 100%, 60%) 100%);
            color: hsl(210, 40%, 8%);
            border: 1px solid hsl(180, 100%, 50%, 0.3);
        }

        .button:enabled:hover {
            box-shadow: 
                0 0 20px hsl(180, 100%, 50%, 0.6),
                0 0 40px hsl(180, 100%, 50%, 0.4),
                0 0 60px hsl(180, 100%, 50%, 0.2);
            transform: translateY(-1px);
        }

        .button:disabled {
            background: hsl(210, 40%, 18%);
            color: hsl(210, 40%, 45%);
            cursor: not-allowed;
        }

        /* Status */
        .status {
            padding-top: 1rem;
            border-top: 1px solid hsl(210, 40%, 20%, 0.3);
        }

        .status-text {
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        /* Status colors */
        .status-idle {
            color: hsl(210, 40%, 45%);
        }

        .status-connecting {
            color: hsl(180, 100%, 50%);
            text-shadow: 0 0 10px hsl(180, 100%, 50%, 0.5);
        }

        .status-listening {
            color: hsl(180, 100%, 50%);
            text-shadow: 0 0 10px hsl(180, 100%, 50%, 0.5);
            animation: pulse 2s infinite;
        }

        .status-thinking {
            color: hsl(300, 100%, 70%);
            text-shadow: 0 0 10px hsl(300, 100%, 70%, 0.5);
        }

        .status-error {
            color: hsl(0, 84%, 60%);
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        /* Mobile responsiveness */
        @media (max-width: 640px) {
            .container {
                padding: 0.5rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .title {
                font-size: 1.5rem;
            }
            
            .button {
                height: 3.5rem;
                font-size: 1rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="card">
            <!-- Header -->
            <div class="header">
                <h1 class="title">Nutrition</h1>
            </div>

            <!-- Start Button -->
            <button id="startButton" class="button">
                Begin
            </button>

            <!-- Status Display -->
            <div class="status">
                <p id="statusText" class="status-text status-idle">
                    Ready to connect
                </p>
            </div>
        </div>
    </div>

    <!-- Vapi SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@vapi-ai/web@2.3.8/dist/index.js"></script>
    
    <script>
        // Vapi Configuration - easily accessible constants
        const VAPI_PUBLIC_KEY = '9a3cbf9c-d1df-476f-984c-ce78100189f9';
        const ASSISTANT_ID = 'a9cafb7c-3874-433d-b697-9edeb3445575';

        // Application state
        let status = 'idle';
        let isCallActive = false;
        let vapi = null;

        // DOM elements
        const startButton = document.getElementById('startButton');
        const statusText = document.getElementById('statusText');

        // Status text mapping
        const statusMessages = {
            idle: 'Ready to connect',
            connecting: 'Connecting...',
            listening: 'Listening...',
            thinking: 'Thinking...',
            error: 'Connection error'
        };

        // Update UI based on current status
        function updateUI() {
            // Update status text
            statusText.textContent = statusMessages[status] || statusMessages.idle;
            
            // Update status text class
            statusText.className = 'status-text status-' + status;
            
            // Update button
            if (isCallActive) {
                startButton.textContent = 'Call Active';
                startButton.disabled = true;
            } else {
                startButton.textContent = 'Begin';
                startButton.disabled = false;
            }
        }

        // Set status and update UI
        function setStatus(newStatus) {
            status = newStatus;
            updateUI();
        }

        // Initialize Vapi
        function initializeVapi() {
            console.log('Initializing Vapi...');
            if (!window.Vapi) {
                console.error('Vapi SDK not loaded');
                alert('Vapi SDK failed to load. Please check your internet connection.');
                setStatus('error');
                return;
            }

            console.log('Creating Vapi instance with key:', VAPI_PUBLIC_KEY);
            vapi = new window.Vapi(VAPI_PUBLIC_KEY);

            // Set up event listeners
            vapi.on('call-start', () => {
                console.log('Call started');
                setStatus('connecting');
                isCallActive = true;
                updateUI();
            });

            vapi.on('call-end', () => {
                console.log('Call ended');
                setStatus('idle');
                isCallActive = false;
                updateUI();
            });

            vapi.on('speech-start', () => {
                console.log('Speech started');
                setStatus('listening');
            });

            vapi.on('speech-end', () => {
                console.log('Speech ended');
                setStatus('thinking');
            });

            vapi.on('error', (error) => {
                console.error('Vapi error:', error);
                setStatus('error');
                isCallActive = false;
                updateUI();
            });
        }

        // Start call function
        async function startCall() {
            console.log('Start call button clicked');
            console.log('Vapi instance:', vapi);
            console.log('Call active:', isCallActive);
            
            if (!vapi) {
                console.error('Vapi instance not available');
                alert('Vapi not initialized. Please refresh the page.');
                setStatus('error');
                return;
            }
            
            if (isCallActive) {
                console.log('Call already active, ignoring');
                return;
            }

            try {
                console.log('Starting call with assistant ID:', ASSISTANT_ID);
                setStatus('connecting');
                await vapi.start(ASSISTANT_ID);
                console.log('Call started successfully');
            } catch (error) {
                console.error('Failed to start call:', error);
                alert('Failed to start call: ' + error.message);
                setStatus('error');
            }
        }

        // Event listeners
        startButton.addEventListener('click', startCall);

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Wait for Vapi SDK to load
            if (window.Vapi) {
                initializeVapi();
            } else {
                // Poll for Vapi availability
                const checkVapi = setInterval(() => {
                    if (window.Vapi) {
                        clearInterval(checkVapi);
                        initializeVapi();
                    }
                }, 100);
            }
            
            // Initial UI update
            updateUI();
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (vapi) {
                vapi.stop();
            }
        });
    </script>
</body>
</html>
